<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.jsy.mapper.NewShopMapper">

    <!-- 通用查询映射结果 -->
    <resultMap id="BaseResultMap" type="com.jsy.domain.NewShop">
        <id column="id" property="id" />
        <result column="owner_uuid" property="ownerUuid" />
        <result column="city" property="city" />
        <result column="shop_name" property="shopName" />
        <result column="mobile" property="mobile" />
        <result column="shop_logo" property="shopLogo" />
        <result column="business_img" property="businessImg" />
        <result column="business_number" property="businessNumber" />
        <result column="company_name" property="companyName" />
        <result column="shop_username" property="shopUsername" />
        <result column="shop_phone" property="shopPhone" />
        <result column="shop_cid_Zimg" property="shopCidZimg" />
        <result column="shop_cid_Fimg" property="shopCidFimg" />
        <result column="id_name" property="idName" />
        <result column="id_number" property="idNumber" />
        <result column="bank_images" property="bankImages" />
        <result column="bank_number" property="bankNumber" />
        <result column="deposit_bank" property="depositBank" />
        <result column="branch_bank" property="branchBank" />
        <result column="aliPay" property="aliPay" />
        <result column="weChat" property="weChat" />
        <result column="update_time" property="updateTime" />
        <result column="deleted" property="deleted" />
        <result column="longitude" property="longitude" />
        <result column="latitude" property="latitude" />

        <result column="distance" property="distance" />
    </resultMap>
    <select id="mainSearch" resultType="com.jsy.domain.NewShop">
        SELECT * FROM w_new_shop WHERE shop_name LIKE CONCAT("%",#{keyword},"%") AND deleted = 0
        UNION
        SELECT s.* FROM w_goods g LEFT JOIN w_new_shop s ON g.shop_id=s.id WHERE g.title like CONCAT("%",#{keyword},"%")
        AND g.is_putaway=1  AND g.deleted = 0 AND s.deleted=0
    </select>
<!-- 查询距离 -->
    <select id="selectAddress" resultType="com.jsy.domain.NewShop">
        SELECT
        *,
        round (
        (
        6378.138 * 2 * ASIN(
        SQRT(
        POW(
        SIN( ( 29.607283 * PI( ) / 180 - t1.latitude * PI( ) / 180 ) / 2 ),
        2
        ) + COS( 29.607283 * PI( ) / 180 ) * COS( t1.latitude * PI( ) / 180 ) * POW(
        SIN( ( 106.550442 * PI( ) / 180 - t1.longitude * PI( ) / 180 ) / 2 ),
        2
        )
        )
        ) * 1000
        )
        )  as distance
        from  w_new_shop t1  WHERE
        round (
        (
        6378.138 * 2 * ASIN(
        SQRT(
        POW(
        SIN( ( 29.607283 * PI( ) / 180 - t1.latitude * PI( ) / 180 ) / 2 ),
        2
        ) + COS( 29.607283 * PI( ) / 180 ) * COS( t1.latitude * PI( ) / 180 ) * POW(
        SIN( ( 106.550442 * PI( ) / 180 - t1.longitude * PI( ) / 180 ) / 2 ),
        2
        )
        )
        ) * 1000
        )
        )
        &lt;3000

    </select>

</mapper>
